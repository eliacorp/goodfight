{"version":3,"file":"gorniv-ngx-transfer-http.umd.js.map","sources":["ng://@gorniv/ngx-transfer-http/src/transfer-http.service.ts","ng://@gorniv/ngx-transfer-http/src/transfer-http.module.ts"],"sourcesContent":["import { Injectable, Inject, PLATFORM_ID } from '@angular/core';\nimport { HttpClient, HttpHeaders, HttpParams } from '@angular/common/http';\nimport { TransferState } from '@angular/platform-browser';\nimport { Observable, from } from 'rxjs';\nimport { tap } from 'rxjs/operators';\nimport { isPlatformBrowser, isPlatformServer } from '@angular/common';\n\n@Injectable()\nexport class TransferHttpService {\n  constructor(\n    protected transferState: TransferState,\n    private httpClient: HttpClient,\n    @Inject(PLATFORM_ID) private platformId: Object\n  ) {\n\n  }\n\n  public request(method: string, uri: string | Request, options?: {\n    body?: any;\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    observe?: 'response';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getData(method, uri, options, (method: string, url: string, options: any) => {\n      return this.httpClient.request(method, url, options);\n    });\n  }\n\n  /**\n   * Performs a request with `get` http method.\n   */\n  get(url: string, options?: {\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    observe?: 'response';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getData('get', url, options, (method: string, url: string, options: any) => {\n      return this.httpClient.get(url, options);\n    });\n  }\n\n  /**\n   * Performs a request with `post` http method.\n   */\n  post(url: string, body: any, options?: {\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    observe?: 'response';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getPostData('post', url, body, options, (url: string, body: any, options: any): Observable<any> => {\n      return this.httpClient.post(url, body, options);\n    });\n  }\n\n  /**\n   * Performs a request with `put` http method.\n   */\n  put(url: string, body: any, options?: {\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    observe?: 'body';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getData('put', url, options, (method: string, url: string, options: any) => {\n      return this.httpClient.put(url, options);\n    });\n  }\n\n\n  /**\n   * Performs a request with `delete` http method.\n   */\n  delete(url: string, options?: {\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    observe?: 'response';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getData('delete', url, options, (method: string, url: string, options: any) => {\n      return this.httpClient.delete(url, options);\n    });\n  }\n\n  /**\n   * Performs a request with `patch` http method.\n   */\n  patch(url: string, body: any, options?: {\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    observe?: 'response';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getPostData('patch', url, body, options, (url: string, body: any, options: any): Observable<any> => {\n      return this.httpClient.patch(url, body, options);\n    });\n  }\n\n  /**\n   * Performs a request with `head` http method.\n   */\n  head(url: string, options?: {\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    observe?: 'response';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getData('head', url, options, (method: string, url: string, options: any) => {\n      return this.httpClient.head(url, options);\n    });\n  }\n\n  /**\n   * Performs a request with `options` http method.\n   */\n  options(url: string, options?: {\n    headers?: HttpHeaders | {\n      [header: string]: string | string[];\n    };\n    observe?: 'response';\n    params?: HttpParams | {\n      [param: string]: string | string[];\n    };\n    reportProgress?: boolean;\n    responseType?: 'json';\n    withCredentials?: boolean;\n  }): Observable<any> {\n    // tslint:disable-next-line:no-shadowed-variable\n    return this.getData('options', url, options, (method: string, url: string, options: any) => {\n      return this.httpClient.options(url, options);\n    });\n  }\n\n  // tslint:disable-next-line:max-line-length\n  private getData(method: string,\n    uri: string | Request,\n    options: any,\n    callback: (method: string, uri: string | Request, options: any) => Observable<any>): any {\n\n    let url = uri;\n\n    if (typeof uri !== 'string') {\n      url = uri.url;\n    }\n\n    const key = url + (options ? JSON.stringify(options) : '');\n\n    try {\n      return this.resolveData(key);\n    } catch (e) {\n      return callback(method, uri, options)\n        .pipe(tap(data => {\n          if (isPlatformBrowser(this.platformId)) {\n            // Client only code.\n            // nothing;\n          }\n          if (isPlatformServer(this.platformId)) {\n            this.setCache(key, data);\n          }\n        }));\n    }\n  }\n\n  // tslint:disable-next-line:max-line-length\n  private getPostData(method: string,\n    uri: string | Request,\n    body: any, options: any,\n    callback: (uri: string | Request, body: any, options: any) => Observable<Response>): any {\n\n    let url = uri;\n\n    if (typeof uri !== 'string') {\n      url = uri.url;\n    }\n\n    const key = url + (body ? JSON.stringify(body) : '') + (options ? JSON.stringify(options) : '');\n\n    try {\n      return this.resolveData(key);\n    } catch (e) {\n      return callback(uri, body, options)\n        .pipe(tap(data => {\n          if (isPlatformBrowser(this.platformId)) {\n            // Client only code.\n            // nothing;\n          }\n          if (isPlatformServer(this.platformId)) {\n            this.setCache(key, data);\n          }\n        }));\n    }\n  }\n\n  private resolveData(key: any): any {\n    const data = this.getFromCache(key);\n\n    if (!data) {\n      throw new Error();\n    }\n\n    if (isPlatformBrowser(this.platformId)) {\n      // Client only code.\n      this.transferState.remove(key);\n    }\n    if (isPlatformServer(this.platformId)) {\n      // Server only code.\n    }\n\n    return from(Promise.resolve(data));\n  }\n\n  private setCache(key, data): any {\n    return this.transferState.set(key, data);\n  }\n\n  private getFromCache(key): any {\n    return this.transferState.get(key, null);\n  }\n}\n","import { NgModule } from '@angular/core';\n\nimport { TransferHttpService } from './transfer-http.service';\n\n@NgModule({\n  providers: [TransferHttpService]\n})\nexport class TransferHttpModule {\n}\n"],"names":["tap","isPlatformBrowser","isPlatformServer","from","Injectable","TransferState","HttpClient","Inject","PLATFORM_ID","NgModule"],"mappings":"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"}
